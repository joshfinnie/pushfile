"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=exports.createConfig=void 0;var _awsSdk=_interopRequireDefault(require("aws-sdk"));var _hashids=_interopRequireDefault(require("hashids"));var _copyPaste=_interopRequireDefault(require("copy-paste"));var _crypto=_interopRequireDefault(require("crypto"));var _fs=_interopRequireDefault(require("fs"));var _inquirer=_interopRequireDefault(require("inquirer"));var _mimeTypes=_interopRequireDefault(require("mime-types"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var config=require("".concat(process.env.HOME,"/.pushfile.json"));var hashFile=function hashFile(filename,salt,callback){var shortFilename;var fd=_fs.default.createReadStream(filename);var hash=_crypto.default.createHash("sha1").setEncoding("hex");fd.pipe(hash);fd.on("end",function(){hash.end();shortFilename=new _hashids.default(salt,10).encodeHex(hash.read());callback("".concat(shortFilename,".").concat(filename.split(".").pop()))})};var createS3Bucket=function createS3Bucket(){var s3Bucket;if(config){_awsSdk.default.config.update({accessKeyId:config.awsKey,secretAccessKey:config.awsSecret});s3Bucket=new _awsSdk.default.S3({params:{Bucket:config.s3Bucket}})}else{console.log("Looks like your PushFile config file is missing.\nPlease run `pushfile --configuration` to set up.\n");process.exit(1)}return s3Bucket};var createConfig=function createConfig(){var questions=[{name:"awsClientKey",type:"input",message:"Enter your AWS Client Key",validate:function validate(value){return value.length?true:"Please enter your AWS Client Key"}},{name:"awsSecretKey",type:"input",message:"Enter your AWS Secret Key",validate:function validate(value){return value.length?true:"Please enter your AWS Secret Key"}},{name:"awsS3Bucket",type:"input",message:"Enter your AWS S3 Bucket",validate:function validate(value){return value.length?true:"Please enter your AWS S3 Bucket"}},{name:"customURL",type:"input",message:"Enter your custom URL (not required)",validate:function validate(){return true}}];_inquirer.default.prompt(questions).then(function(keys){var configFile={awsKey:keys.awsClientKey,awsSecret:keys.awsSecretKey,s3Bucket:keys.awsS3Bucket};if(keys.customURL){configFile.customURL=keys.customURL}_fs.default.writeFile("".concat(process.env.HOME,"/.pushfile.json"),JSON.stringify(configFile),function(err){if(err)throw err;console.log("Configuration file was written.")})}).catch(function(err){return console.log(err)})};exports.createConfig=createConfig;var pushFile=function pushFile(fileName,unique){console.log("Pushing a ".concat(unique?"unique":"not unique"," file named ").concat(fileName,"."));var bucket=createS3Bucket();var salt=unique?_crypto.default.randomBytes(12).toString("hex"):"wR2BXqWhHC9b4kbgl6qNei9d";hashFile(fileName,salt,function(newFileName){var contentType=_mimeTypes.default.lookup(fileName);_fs.default.readFile(fileName,function(err,fileBuffer){var params={Key:newFileName,ACL:"public-read",Body:fileBuffer,ContentType:contentType};bucket.upload(params,function(uploadErr,uploadData){if(uploadErr){console.log("Unable to upload:",err.stack)}else if(typeof config.url==="undefined"){console.log("File is available at",uploadData.Location);_copyPaste.default.copy(uploadData.Location)}else{var location="".concat(config.url,"/").concat(newFileName);console.log("File is available at",location);_copyPaste.default.copy(location)}})})})};exports.default=pushFile;"use strict";var _chalk=_interopRequireDefault(require("chalk"));var _figlet=_interopRequireDefault(require("figlet"));var _commander=_interopRequireDefault(require("commander"));var _package=require("../package.json");var _helpers=_interopRequireWildcard(require("./helpers"));function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):{};if(desc.get||desc.set){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}console.log(_chalk.default.red(_figlet.default.textSync("PushFile!",{horizontalLayout:"full"})));_commander.default.version(_package.version).usage("[options] <file ...>").option("-u, --unique","Gives a unique hash for uploaded file.").option("-c, --configure","Create a configuration file.").option("-v, --version","Prints Version");_commander.default.parse(process.argv);var argsLength=_commander.default.args.length;if(_commander.default.configure){(0,_helpers.createConfig)()}else if(argsLength>0){(0,_helpers.default)(_commander.default.args[0],_commander.default.unique)}else if(argsLength<=0){console.log("no filename...")}