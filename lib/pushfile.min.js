"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var chalk=_interopDefault(require("chalk")),figlet=_interopDefault(require("figlet")),commander=_interopDefault(require("commander")),AWS=_interopDefault(require("aws-sdk")),clipboardy=_interopDefault(require("clipboardy")),crypto=_interopDefault(require("crypto")),fs=_interopDefault(require("fs")),inquirer=_interopDefault(require("inquirer")),mime=_interopDefault(require("mime-types")),version="1.1.3",commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function unwrapExports(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}var hashids=createCommonjsModule((function(e,t){!function(e){function t(e){return function(e){if(Array.isArray(e))return e}(e)||r(e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function n(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||r(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function r(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(e,"__esModule",{value:!0}),e.unicodeSubstr=e.onlyChars=e.withoutChars=e.keepUniqueChars=e.default=void 0;var a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"cfhistuCFHISTU";if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.salt=t,this.minLength=r,"number"!=typeof r)throw new TypeError("Hashids: Provided 'minLength' has to be a number (is ".concat(i(r),")"));if("string"!=typeof t)throw new TypeError("Hashids: Provided 'salt' has to be a string (is ".concat(i(t),")"));if("string"!=typeof o)throw new TypeError("Hashids: Provided alphabet has to be a string (is ".concat(i(o),")"));var g=l(o);if(g.length<s)throw new Error("Hashids: alphabet must contain at least ".concat(s," unique characters, provided: ").concat(g));this.alphabet=f(g,a);var d,v,m=h(a,g);this.seps=y(m,t),(0===n(this.seps).length||n(this.alphabet).length/n(this.seps).length>u)&&(d=Math.ceil(n(this.alphabet).length/u))>n(this.seps).length&&(v=d-n(this.seps).length,this.seps+=p(this.alphabet,0,v),this.alphabet=p(this.alphabet,v)),this.alphabet=y(this.alphabet,t);var b=Math.ceil(n(this.alphabet).length/c);n(this.alphabet).length<3?(this.guards=p(this.seps,0,b),this.seps=p(this.seps,b)):(this.guards=p(this.alphabet,0,b),this.alphabet=p(this.alphabet,b))}var r,a,w;return r=e,(a=[{key:"encode",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];var o="";return(r=Array.isArray(e)?e:[].concat(n(null!=e?[e]:[]),n(r))).length?(r.every(g)||(r=r.map((function(e){return"bigint"==typeof e||"number"==typeof e?e:S(String(e))}))),r.every(d)?this._encode(r):o):o}},{key:"decode",value:function(e){return e&&"string"==typeof e&&0!==e.length?this._decode(e,this.alphabet):[]}},{key:"encodeHex",value:function(e){switch(i(e)){case"bigint":e=e.toString(16);break;case"string":if(!/^[0-9a-fA-F]+$/.test(e))return"";break;default:throw new Error("Hashids: The provided value is neither a string, nor a BigInt (got: ".concat(i(e),")"))}var t=A(e,12,(function(e){return parseInt("1".concat(e),16)}));return this.encode(t)}},{key:"decodeHex",value:function(e){return this.decode(e).map((function(e){return e.toString(16).slice(1)})).join("")}},{key:"_encode",value:function(e){var t,r=this,i=this.alphabet,o=e.reduce((function(e,t,n){return e+("bigint"==typeof t?Number(t%BigInt(n+100)):t%(n+100))}),0),a=t=n(i)[o%n(i).length],s=n(this.seps),u=n(this.guards);if(e.forEach((function(n,o){var u=a+r.salt+i;i=y(i,p(u,0));var c=v(n,i);if(t+=c,o+1<e.length){var l=c.codePointAt(0)+o,f="bigint"==typeof n?Number(n%BigInt(l)):n%l;t+=s[f%s.length]}})),n(t).length<this.minLength){var c=(o+n(t)[0].codePointAt(0))%u.length;if(n(t=u[c]+t).length<this.minLength){var l=(o+n(t)[2].codePointAt(0))%u.length;t+=u[l]}}for(var f=Math.floor(n(i).length/2);n(t).length<this.minLength;){i=y(i,i);var h=n(t=p(i,f)+t+p(i,0,f)).length-this.minLength;h>0&&(t=p(t,h/2,this.minLength))}return t}},{key:"_decode",value:function(e,r){var i=this,o=b(e,(function(e){return i.guards.includes(e)})),a=n(o[3===o.length||2===o.length?1:0]);if(0===a.length)return[];var s=t(a),u=s[0],c=s.slice(1).join(""),l=b(c,(function(e){return i.seps.includes(e)})).reduce((function(e,t){var r=e.result,o=e.lastAlphabet,a=u+i.salt+o,s=y(o,p(a,0,n(o).length));return{result:[].concat(n(r),[m(t,s)]),lastAlphabet:s}}),{result:[],lastAlphabet:r}).result;return this._encode(l)!==e?[]:l}}])&&o(r.prototype,a),w&&o(r,w),e}();e.default=a;var s=16,u=3.5,c=12,l=function(e){return Array.from(new Set(e)).join("")};e.keepUniqueChars=l;var f=function(e,n){var r=t(e).slice(0),i=t(n).slice(0);return r.filter((function(e){return!i.includes(e)})).join("")};e.withoutChars=f;var h=function(e,n){var r=t(e).slice(0),i=t(n).slice(0);return r.filter((function(e){return i.includes(e)})).join("")};e.onlyChars=h;var p=function(e,n,r){return t(e).slice(0).slice(n,void 0===r?void 0:n+r).join("")};e.unicodeSubstr=p;var g=function(e){return"bigint"==typeof e||!Number.isNaN(Number(e))&&Math.floor(Number(e))===e},d=function(e){return"bigint"==typeof e||e>=0&&Number.isSafeInteger(e)};function y(e,r){var i,o=t(r).slice(0);if(!o.length)return e;for(var a=n(e),s=a.length-1,u=0,c=0;s>0;s--,u++){c+=i=o[u%=o.length].codePointAt(0);var l=(i+u+c)%s,f=[a[s],a[l]];a[l]=f[0],a[s]=f[1]}return a.join("")}var v=function(e,n){var r=t(n).slice(0),i="";if("bigint"==typeof e){var o=BigInt(r.length);do{i=r[Number(e%o)]+i,e/=o}while(e)}else do{i=r[e%r.length]+i,e=Math.floor(e/r.length)}while(e);return i},m=function(e,n){var r=t(e).slice(0),i=t(n).slice(0);return r.map((function(e){return i.indexOf(e)})).reduce((function(e,t){if("bigint"==typeof e)return e*BigInt(i.length)+BigInt(t);var n=e*i.length+t;if(Number.isSafeInteger(n))return n;if("function"==typeof BigInt)return BigInt(e)*BigInt(i.length)+BigInt(t);throw new Error("Unable to decode the provided string, due to lack of support for BigInt numbers in the current environment")}),0)},b=function(e,r){return t(e).slice(0).reduce((function(e,t){return r(t)?[].concat(n(e),[""]):[].concat(n(e.slice(0,-1)),[e[e.length-1]+t])}),[""])},w=/^\+?[0-9]+$/,S=function(e){return w.test(e)?parseInt(e,10):NaN},A=function(e,t,n){return Array.from({length:Math.ceil(e.length/t)},(function(r,i){return n(e.slice(i*t,(i+1)*t))}))}}(t)}));unwrapExports(hashids);var cjs=hashids.default,config=require("".concat(process.env.HOME,"/.pushfile.json")),hashFile=function(e,t,n){var r,i=fs.createReadStream(e),o=crypto.createHash("sha1").setEncoding("hex");i.pipe(o),i.on("end",(function(){o.end(),r=new cjs(t,10).encodeHex(o.read()),n("".concat(r,".").concat(e.split(".").pop()))}))},createS3Bucket=function(){var e;return config?(AWS.config.update({accessKeyId:config.awsKey,secretAccessKey:config.awsSecret}),e=new AWS.S3({params:{Bucket:config.s3Bucket}})):(console.log("Looks like your PushFile config file is missing.\nPlease run `pushfile --configuration` to set up.\n"),process.exit(1)),e},createConfig=function(){inquirer.prompt([{name:"awsClientKey",type:"input",message:"Enter your AWS Client Key",validate:function(e){return!!e.length||"Please enter your AWS Client Key"}},{name:"awsSecretKey",type:"input",message:"Enter your AWS Secret Key",validate:function(e){return!!e.length||"Please enter your AWS Secret Key"}},{name:"awsS3Bucket",type:"input",message:"Enter your AWS S3 Bucket",validate:function(e){return!!e.length||"Please enter your AWS S3 Bucket"}},{name:"customURL",type:"input",message:"Enter your custom URL (not required)",validate:function(){return!0}}]).then((function(e){var t={awsKey:e.awsClientKey,awsSecret:e.awsSecretKey,s3Bucket:e.awsS3Bucket};e.customURL&&(t.customURL=e.customURL),fs.writeFile("".concat(process.env.HOME,"/.pushfile.json"),JSON.stringify(t),(function(e){if(e)throw e;console.log("Configuration file was written.")}))})).catch((function(e){return console.log(e)}))},pushFile=function(e,t){var n=createS3Bucket(),r=t?crypto.randomBytes(12).toString("hex"):"wR2BXqWhHC9b4kbgl6qNei9d";hashFile(e,r,(function(t){var r=mime.lookup(e);fs.readFile(e,(function(e,i){var o={Key:t,ACL:"public-read",Body:i,ContentType:r};n.upload(o,(function(n,r){if(n)console.log("Unable to upload:",e.stack);else if(void 0===config.url)console.log("File is available at",r.Location),clipboardy.writeSync(r.Location);else{var i="".concat(config.url,"/").concat(t);console.log("File is available at",i),clipboardy.writeSync(i)}}))}))}))};console.log(chalk.red(figlet.textSync("PushFile!",{horizontalLayout:"full"}))),commander.version(version).usage("[options] <file ...>").option("-u, --unique","Gives a unique hash for uploaded file.").option("-c, --configure","Create a configuration file.").option("-v, --version","Prints Version"),commander.parse(process.argv);var argsLength=commander.args.length;commander.configure?createConfig():argsLength>0?pushFile(commander.args[0],commander.unique):argsLength<=0&&console.log("no filename...");
