"use strict";var e=require("chalk"),t=require("figlet"),n=require("commander"),r=require("aws-sdk"),i=require("clipboardy"),o=require("crypto"),a=require("fs"),s=require("inquirer"),u=require("mime-types");function l(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var h=l(e),c=l(t),f=l(r),p=l(i),g=l(o),d=l(a),y=l(s),v=l(u);"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var b,m,w=(function(e,t){"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,function(e){function t(e){return i(e)||r(e)||n()}function n(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function r(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function i(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}e.__esModule=!0,e.onlyChars=e.withoutChars=e.keepUnique=e.default=void 0;var o=function(){function e(e,n,r,i){if(void 0===e&&(e=""),void 0===n&&(n=0),void 0===r&&(r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890"),void 0===i&&(i="cfhistuCFHISTU"),this.minLength=n,"number"!=typeof n)throw new TypeError("Hashids: Provided 'minLength' has to be a number (is "+typeof n+")");if("string"!=typeof e)throw new TypeError("Hashids: Provided 'salt' has to be a string (is "+typeof e+")");if("string"!=typeof r)throw new TypeError("Hashids: Provided alphabet has to be a string (is "+typeof r+")");var o=Array.from(e),f=Array.from(r),p=Array.from(i);this.salt=o;var d=l(f);if(d.length<a)throw new Error("Hashids: alphabet must contain at least "+a+" unique characters, provided: "+d);this.alphabet=h(d,p);var y,v,b,m=c(p,d);this.seps=g(m,o),(0===this.seps.length||this.alphabet.length/this.seps.length>s)&&(y=Math.ceil(this.alphabet.length/s))>this.seps.length&&(v=y-this.seps.length,(b=this.seps).push.apply(b,t(this.alphabet.slice(0,v))),this.alphabet=this.alphabet.slice(v)),this.alphabet=g(this.alphabet,o);var A=Math.ceil(this.alphabet.length/u);this.alphabet.length<3?(this.guards=this.seps.slice(0,A),this.seps=this.seps.slice(A)):(this.guards=this.alphabet.slice(0,A),this.alphabet=this.alphabet.slice(A)),this.guardsRegExp=w(this.guards),this.sepsRegExp=w(this.seps),this.allowedCharsRegExp=S([].concat(t(this.alphabet),t(this.guards),t(this.seps)))}var n=e.prototype;return n.encode=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var o="";return(r=Array.isArray(e)?e:[].concat(t(null!=e?[e]:[]),t(r))).length?(r.every(f)||(r=r.map((function(e){return"bigint"==typeof e||"number"==typeof e?e:b(String(e))}))),r.every(p)?this._encode(r).join(""):o):o},n.decode=function(e){return e&&"string"==typeof e&&0!==e.length?this._decode(e):[]},n.encodeHex=function(e){switch(typeof e){case"bigint":e=e.toString(16);break;case"string":if(!/^[0-9a-fA-F]+$/.test(e))return"";break;default:throw new Error("Hashids: The provided value is neither a string, nor a BigInt (got: "+typeof e+")")}var t=m(e,12,(function(e){return parseInt("1"+e,16)}));return this.encode(t)},n.decodeHex=function(e){return this.decode(e).map((function(e){return e.toString(16).slice(1)})).join("")},n._encode=function(e){var n=this,r=this.alphabet,i=e.reduce((function(e,t,n){return e+("bigint"==typeof t?Number(t%BigInt(n+100)):t%(n+100))}),0),o=[r[i%r.length]],a=o.slice(),s=this.seps,u=this.guards;if(e.forEach((function(i,u){var l,h=a.concat(n.salt,r);r=g(r,h);var c=d(i,r);if((l=o).push.apply(l,t(c)),u+1<e.length){var f=c[0].codePointAt(0)+u,p="bigint"==typeof i?Number(i%BigInt(f)):i%f;o.push(s[p%s.length])}})),o.length<this.minLength){var l=(i+o[0].codePointAt(0))%u.length;if(o.unshift(u[l]),o.length<this.minLength){var h=(i+o[2].codePointAt(0))%u.length;o.push(u[h])}}for(var c=Math.floor(r.length/2);o.length<this.minLength;){var f,p;r=g(r,r),(f=o).unshift.apply(f,t(r.slice(c))),(p=o).push.apply(p,t(r.slice(0,c)));var y=o.length-this.minLength;if(y>0){var v=y/2;o=o.slice(v,v+this.minLength)}}return o},n.isValidId=function(e){return this.allowedCharsRegExp.test(e)},n._decode=function(e){if(!this.isValidId(e))throw new Error("The provided ID ("+e+") is invalid, as it contains characters that do not exist in the alphabet ("+this.guards.join("")+this.seps.join("")+this.alphabet.join("")+")");var n=e.split(this.guardsRegExp),r=n[3===n.length||2===n.length?1:0];if(0===r.length)return[];var i=r[Symbol.iterator]().next().value,o=r.slice(i.length).split(this.sepsRegExp),a=this.alphabet,s=[],u=o,l=Array.isArray(u),h=0;for(u=l?u:u[Symbol.iterator]();;){var c;if(l){if(h>=u.length)break;c=u[h++]}else{if((h=u.next()).done)break;c=h.value}var f=c,p=g(a,[i].concat(t(this.salt),t(a)).slice(0,a.length));s.push(y(Array.from(f),p)),a=p}return this._encode(s).join("")!==e?[]:s},e}();e.default=o;var a=16,s=3.5,u=12,l=function(e){return Array.from(new Set(e))};e.keepUnique=l;var h=function(e,t){return e.filter((function(e){return!t.includes(e)}))};e.withoutChars=h;var c=function(e,t){return e.filter((function(e){return t.includes(e)}))};e.onlyChars=c;var f=function(e){return"bigint"==typeof e||!Number.isNaN(Number(e))&&Math.floor(Number(e))===e},p=function(e){return"bigint"==typeof e||e>=0&&Number.isSafeInteger(e)};function g(e,t){if(0===t.length)return e;for(var n,r=e.slice(),i=r.length-1,o=0,a=0;i>0;i--,o++){a+=n=t[o%=t.length].codePointAt(0);var s=(n+o+a)%i,u=r[i],l=r[s];r[s]=u,r[i]=l}return r}var d=function(e,t){var n=[];if("bigint"==typeof e){var r=BigInt(t.length);do{n.unshift(t[Number(e%r)]),e/=r}while(e>BigInt(0))}else do{n.unshift(t[e%t.length]),e=Math.floor(e/t.length)}while(e>0);return n},y=function(e,t){return e.reduce((function(n,r){var i=t.indexOf(r);if(-1===i)throw new Error("The provided ID ("+e.join("")+") is invalid, as it contains characters that do not exist in the alphabet ("+t.join("")+")");if("bigint"==typeof n)return n*BigInt(t.length)+BigInt(i);var o=n*t.length+i;if(Number.isSafeInteger(o))return o;if("function"==typeof BigInt)return BigInt(n)*BigInt(t.length)+BigInt(i);throw new Error("Unable to decode the provided string, due to lack of support for BigInt numbers in the current environment")}),0)},v=/^\+?[0-9]+$/,b=function(e){return v.test(e)?parseInt(e,10):NaN},m=function(e,t,n){return Array.from({length:Math.ceil(e.length/t)},(function(r,i){return n(e.slice(i*t,(i+1)*t))}))},w=function(e){return new RegExp(e.map((function(e){return A(e)})).sort((function(e,t){return t.length-e.length})).join("|"))},S=function(e){return new RegExp("^["+e.map((function(e){return A(e)})).sort((function(e,t){return t.length-e.length})).join("")+"]+$")},A=function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}}(t)}(b={exports:{}},b.exports),b.exports);(m=w)&&m.__esModule&&Object.prototype.hasOwnProperty.call(m,"default")&&m.default;var S=w.default,A=require("".concat(process.env.HOME,"/.pushfile.json"));console.log(h.default.red(c.default.textSync("PushFile!",{horizontalLayout:"full"}))),n.program.version("2.0.1").usage("[options] <file ...>").option("-u, --unique","Gives a unique hash for uploaded file.").option("-c, --configure","Create a configuration file."),n.program.parse(process.argv);var E,x,I,B,k,q=n.program.args.length;n.program.configure?y.default.prompt([{name:"awsClientKey",type:"input",message:"Enter your AWS Client Key",validate:function(e){return!!e.length||"Please enter your AWS Client Key"}},{name:"awsSecretKey",type:"input",message:"Enter your AWS Secret Key",validate:function(e){return!!e.length||"Please enter your AWS Secret Key"}},{name:"awsS3Bucket",type:"input",message:"Enter your AWS S3 Bucket",validate:function(e){return!!e.length||"Please enter your AWS S3 Bucket"}},{name:"customURL",type:"input",message:"Enter your custom URL (not required)",validate:function(){return!0}}]).then((function(e){var t={awsKey:e.awsClientKey,awsSecret:e.awsSecretKey,s3Bucket:e.awsS3Bucket};e.customURL&&(t.customURL=e.customURL),d.default.writeFile("".concat(process.env.HOME,"/.pushfile.json"),JSON.stringify(t),(function(e){if(e)throw e;console.log("Configuration file was written.")}))})).catch((function(e){return console.log(e)})):q>0?(E=n.program.args[0],x=n.program.unique,A?(f.default.config.update({accessKeyId:A.awsKey,secretAccessKey:A.awsSecret}),I=new f.default.S3({params:{Bucket:A.s3Bucket}})):(console.log("Looks like your PushFile config file is missing.\nPlease run `pushfile --configuration` to set up.\n"),process.exit(1)),B=I,k=x?g.default.randomBytes(12).toString("hex"):"wR2BXqWhHC9b4kbgl6qNei9d",function(e,t){return new Promise((function(n,r){var i,o=d.default.createReadStream(e),a=g.default.createHash("sha1").setEncoding("hex");o.pipe(a),o.on("end",(function(){a.end(),i=new S(t,10).encodeHex(a.read()),n("".concat(i,".").concat(e.split(".").pop()))})),o.on("error",(function(e){r(e)}))}))}(E,k).then((function(e){var t=v.default.lookup(E);d.default.readFile(E,(function(n,r){var i={Key:e,ACL:"public-read",Body:r,ContentType:t};B.upload(i,(function(t,r){if(t)console.log("Unable to upload:",n.stack);else if(void 0===A.url)console.log("File is available at",r.Location),p.default.writeSync(r.Location);else{var i="".concat(A.url,"/").concat(e);console.log("File is available at",i),p.default.writeSync(i)}}))}))}))):q<=0&&console.log("no filename...");
