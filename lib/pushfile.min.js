"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var chalk=_interopDefault(require("chalk")),figlet=_interopDefault(require("figlet")),commander=_interopDefault(require("commander")),AWS=_interopDefault(require("aws-sdk")),Hashids=_interopDefault(require("hashids")),clipboardy=_interopDefault(require("clipboardy")),crypto=_interopDefault(require("crypto")),fs=_interopDefault(require("fs")),inquirer=_interopDefault(require("inquirer")),mime=_interopDefault(require("mime-types")),version="1.0.3",config=require("".concat(process.env.HOME,"/.pushfile.json")),hashFile=function(e,n,t){var o,i=fs.createReadStream(e),r=crypto.createHash("sha1").setEncoding("hex");i.pipe(r),i.on("end",function(){r.end(),o=new Hashids(n,10).encodeHex(r.read()),t("".concat(o,".").concat(e.split(".").pop()))})},createS3Bucket=function(){var e;return config?(AWS.config.update({accessKeyId:config.awsKey,secretAccessKey:config.awsSecret}),e=new AWS.S3({params:{Bucket:config.s3Bucket}})):(console.log("Looks like your PushFile config file is missing.\nPlease run `pushfile --configuration` to set up.\n"),process.exit(1)),e},createConfig=function(){inquirer.prompt([{name:"awsClientKey",type:"input",message:"Enter your AWS Client Key",validate:function(e){return!!e.length||"Please enter your AWS Client Key"}},{name:"awsSecretKey",type:"input",message:"Enter your AWS Secret Key",validate:function(e){return!!e.length||"Please enter your AWS Secret Key"}},{name:"awsS3Bucket",type:"input",message:"Enter your AWS S3 Bucket",validate:function(e){return!!e.length||"Please enter your AWS S3 Bucket"}},{name:"customURL",type:"input",message:"Enter your custom URL (not required)",validate:function(){return!0}}]).then(function(e){var n={awsKey:e.awsClientKey,awsSecret:e.awsSecretKey,s3Bucket:e.awsS3Bucket};e.customURL&&(n.customURL=e.customURL),fs.writeFile("".concat(process.env.HOME,"/.pushfile.json"),JSON.stringify(n),function(e){if(e)throw e;console.log("Configuration file was written.")})}).catch(function(e){return console.log(e)})},pushFile=function(e,n){var t=createS3Bucket(),o=n?crypto.randomBytes(12).toString("hex"):"wR2BXqWhHC9b4kbgl6qNei9d";hashFile(e,o,function(n){var o=mime.lookup(e);fs.readFile(e,function(e,i){var r={Key:n,ACL:"public-read",Body:i,ContentType:o};t.upload(r,function(t,o){if(t)console.log("Unable to upload:",e.stack);else if(void 0===config.url)console.log("File is available at",o.Location),clipboardy.writeSync(o.Location);else{var i="".concat(config.url,"/").concat(n);console.log("File is available at",i),clipboardy.writeSync(i)}})})})};console.log(chalk.red(figlet.textSync("PushFile!",{horizontalLayout:"full"}))),commander.version(version).usage("[options] <file ...>").option("-u, --unique","Gives a unique hash for uploaded file.").option("-c, --configure","Create a configuration file.").option("-v, --version","Prints Version"),commander.parse(process.argv);var argsLength=commander.args.length;commander.configure?createConfig():argsLength>0?pushFile(commander.args[0],commander.unique):argsLength<=0&&console.log("no filename...");
