"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var t=e(require("chalk")),n=e(require("figlet")),r=require("commander"),i=e(require("aws-sdk")),o=e(require("clipboardy")),a=e(require("crypto")),s=e(require("fs")),u=e(require("inquirer")),l=e(require("mime-types"));"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var h,c,f=(function(e,t){"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,function(e){function t(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}e.__esModule=!0,e.onlyChars=e.withoutChars=e.keepUnique=e.default=void 0;var n=function(){function e(e,n,l,h){if(void 0===e&&(e=""),void 0===n&&(n=0),void 0===l&&(l="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890"),void 0===h&&(h="cfhistuCFHISTU"),this.minLength=n,"number"!=typeof n)throw new TypeError("Hashids: Provided 'minLength' has to be a number (is "+typeof n+")");if("string"!=typeof e)throw new TypeError("Hashids: Provided 'salt' has to be a string (is "+typeof e+")");if("string"!=typeof l)throw new TypeError("Hashids: Provided alphabet has to be a string (is "+typeof l+")");var f=Array.from(e),p=Array.from(l),g=Array.from(h);this.salt=f;var d=a(p);if(d.length<r)throw new Error("Hashids: alphabet must contain at least "+r+" unique characters, provided: "+d);this.alphabet=s(d,g);var y,m,w,S=u(g,d);this.seps=c(S,f),(0===this.seps.length||this.alphabet.length/this.seps.length>i)&&(y=Math.ceil(this.alphabet.length/i))>this.seps.length&&(m=y-this.seps.length,(w=this.seps).push.apply(w,t(this.alphabet.slice(0,m))),this.alphabet=this.alphabet.slice(m)),this.alphabet=c(this.alphabet,f);var A=Math.ceil(this.alphabet.length/o);this.alphabet.length<3?(this.guards=this.seps.slice(0,A),this.seps=this.seps.slice(A)):(this.guards=this.alphabet.slice(0,A),this.alphabet=this.alphabet.slice(A)),this.guardsRegExp=v(this.guards),this.sepsRegExp=v(this.seps),this.allowedCharsRegExp=b([].concat(t(this.alphabet),t(this.guards),t(this.seps)))}var n=e.prototype;return n.encode=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var o="";return(r=Array.isArray(e)?e:[].concat(t(null!=e?[e]:[]),t(r))).length?(r.every(l)||(r=r.map((function(e){return"bigint"==typeof e||"number"==typeof e?e:d(String(e))}))),r.every(h)?this._encode(r).join(""):o):o},n.decode=function(e){return e&&"string"==typeof e&&0!==e.length?this._decode(e):[]},n.encodeHex=function(e){switch(typeof e){case"bigint":e=e.toString(16);break;case"string":if(!/^[0-9a-fA-F]+$/.test(e))return"";break;default:throw new Error("Hashids: The provided value is neither a string, nor a BigInt (got: "+typeof e+")")}var t=y(e,12,(function(e){return parseInt("1"+e,16)}));return this.encode(t)},n.decodeHex=function(e){return this.decode(e).map((function(e){return e.toString(16).slice(1)})).join("")},n._encode=function(e){var n=this,r=this.alphabet,i=e.reduce((function(e,t,n){return e+("bigint"==typeof t?Number(t%BigInt(n+100)):t%(n+100))}),0),o=[r[i%r.length]],a=o.slice(),s=this.seps,u=this.guards;if(e.forEach((function(i,u){var l,h=a.concat(n.salt,r);r=c(r,h);var p=f(i,r);if((l=o).push.apply(l,t(p)),u+1<e.length){var g=p[0].codePointAt(0)+u,d="bigint"==typeof i?Number(i%BigInt(g)):i%g;o.push(s[d%s.length])}})),o.length<this.minLength){var l=(i+o[0].codePointAt(0))%u.length;if(o.unshift(u[l]),o.length<this.minLength){var h=(i+o[2].codePointAt(0))%u.length;o.push(u[h])}}for(var p=Math.floor(r.length/2);o.length<this.minLength;){var g,d;r=c(r,r),(g=o).unshift.apply(g,t(r.slice(p))),(d=o).push.apply(d,t(r.slice(0,p)));var y=o.length-this.minLength;if(y>0){var v=y/2;o=o.slice(v,v+this.minLength)}}return o},n.isValidId=function(e){return this.allowedCharsRegExp.test(e)},n._decode=function(e){if(!this.isValidId(e))throw new Error("The provided ID ("+e+") is invalid, as it contains characters that do not exist in the alphabet ("+this.guards.join("")+this.seps.join("")+this.alphabet.join("")+")");var n=e.split(this.guardsRegExp),r=n[3===n.length||2===n.length?1:0];if(0===r.length)return[];var i=r[Symbol.iterator]().next().value,o=r.slice(i.length).split(this.sepsRegExp),a=this.alphabet,s=[],u=o,l=Array.isArray(u),h=0;for(u=l?u:u[Symbol.iterator]();;){var f;if(l){if(h>=u.length)break;f=u[h++]}else{if((h=u.next()).done)break;f=h.value}var g=f,d=c(a,[i].concat(t(this.salt),t(a)).slice(0,a.length));s.push(p(Array.from(g),d)),a=d}return this._encode(s).join("")!==e?[]:s},e}();e.default=n;var r=16,i=3.5,o=12,a=function(e){return Array.from(new Set(e))};e.keepUnique=a;var s=function(e,t){return e.filter((function(e){return!t.includes(e)}))};e.withoutChars=s;var u=function(e,t){return e.filter((function(e){return t.includes(e)}))};e.onlyChars=u;var l=function(e){return"bigint"==typeof e||!Number.isNaN(Number(e))&&Math.floor(Number(e))===e},h=function(e){return"bigint"==typeof e||e>=0&&Number.isSafeInteger(e)};function c(e,t){if(0===t.length)return e;for(var n,r=e.slice(),i=r.length-1,o=0,a=0;i>0;i--,o++){a+=n=t[o%=t.length].codePointAt(0);var s=(n+o+a)%i,u=r[i],l=r[s];r[s]=u,r[i]=l}return r}var f=function(e,t){var n=[];if("bigint"==typeof e){var r=BigInt(t.length);do{n.unshift(t[Number(e%r)]),e/=r}while(e>BigInt(0))}else do{n.unshift(t[e%t.length]),e=Math.floor(e/t.length)}while(e>0);return n},p=function(e,t){return e.reduce((function(n,r){var i=t.indexOf(r);if(-1===i)throw new Error("The provided ID ("+e.join("")+") is invalid, as it contains characters that do not exist in the alphabet ("+t.join("")+")");if("bigint"==typeof n)return n*BigInt(t.length)+BigInt(i);var o=n*t.length+i;if(Number.isSafeInteger(o))return o;if("function"==typeof BigInt)return BigInt(n)*BigInt(t.length)+BigInt(i);throw new Error("Unable to decode the provided string, due to lack of support for BigInt numbers in the current environment")}),0)},g=/^\+?[0-9]+$/,d=function(e){return g.test(e)?parseInt(e,10):NaN},y=function(e,t,n){return Array.from({length:Math.ceil(e.length/t)},(function(r,i){return n(e.slice(i*t,(i+1)*t))}))},v=function(e){return new RegExp(e.map((function(e){return m(e)})).sort((function(e,t){return t.length-e.length})).join("|"))},b=function(e){return new RegExp("^["+e.map((function(e){return m(e)})).sort((function(e,t){return t.length-e.length})).join("")+"]+$")},m=function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}}(t)}(h={exports:{}},h.exports),h.exports);(c=f)&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")&&c.default;var p=f.default,g=require("".concat(process.env.HOME,"/.pushfile.json"));console.log(t.red(n.textSync("PushFile!",{horizontalLayout:"full"}))),r.program.version("1.2.0").usage("[options] <file ...>").option("-u, --unique","Gives a unique hash for uploaded file.").option("-c, --configure","Create a configuration file."),r.program.parse(process.argv);var d,y,v,b,m,w=r.program.args.length;r.program.configure?u.prompt([{name:"awsClientKey",type:"input",message:"Enter your AWS Client Key",validate:function(e){return!!e.length||"Please enter your AWS Client Key"}},{name:"awsSecretKey",type:"input",message:"Enter your AWS Secret Key",validate:function(e){return!!e.length||"Please enter your AWS Secret Key"}},{name:"awsS3Bucket",type:"input",message:"Enter your AWS S3 Bucket",validate:function(e){return!!e.length||"Please enter your AWS S3 Bucket"}},{name:"customURL",type:"input",message:"Enter your custom URL (not required)",validate:function(){return!0}}]).then((function(e){var t={awsKey:e.awsClientKey,awsSecret:e.awsSecretKey,s3Bucket:e.awsS3Bucket};e.customURL&&(t.customURL=e.customURL),s.writeFile("".concat(process.env.HOME,"/.pushfile.json"),JSON.stringify(t),(function(e){if(e)throw e;console.log("Configuration file was written.")}))})).catch((function(e){return console.log(e)})):w>0?(d=r.program.args[0],y=r.program.unique,g?(i.config.update({accessKeyId:g.awsKey,secretAccessKey:g.awsSecret}),v=new i.S3({params:{Bucket:g.s3Bucket}})):(console.log("Looks like your PushFile config file is missing.\nPlease run `pushfile --configuration` to set up.\n"),process.exit(1)),b=v,m=y?a.randomBytes(12).toString("hex"):"wR2BXqWhHC9b4kbgl6qNei9d",function(e,t){return new Promise((function(n,r){var i,o=s.createReadStream(e),u=a.createHash("sha1").setEncoding("hex");o.pipe(u),o.on("end",(function(){u.end(),i=new p(t,10).encodeHex(u.read()),n("".concat(i,".").concat(e.split(".").pop()))})),o.on("error",(function(e){r(e)}))}))}(d,m).then((function(e){var t=l.lookup(d);s.readFile(d,(function(n,r){var i={Key:e,ACL:"public-read",Body:r,ContentType:t};b.upload(i,(function(t,r){if(t)console.log("Unable to upload:",n.stack);else if(void 0===g.url)console.log("File is available at",r.Location),o.writeSync(r.Location);else{var i="".concat(g.url,"/").concat(e);console.log("File is available at",i),o.writeSync(i)}}))}))}))):w<=0&&console.log("no filename...");
